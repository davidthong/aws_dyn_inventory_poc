---
- name: Build YML File
  hosts: localhost
  connection: local
  vars_files: aws_inventory_sources.yml

  tasks:

    - name: Set facts
      ansible.builtin.set_fact:
        var2:
          - 511309077648
          - 311331131131

    - name: Copy Content
      ansible.builtin.blockinfile:
        path: vars/aws_inventory_sources.yml
        block: "{{ var2 | to_nice_yaml }}"
        insertafter: "aig_accounts"
        mode: "0755"

    - name: Build Inventory Sources
      ansible.builtin.template:
         src: aws_ec2.yml.j2
         dest: inventory/aig_{{ aws_account }}_aws_ec2.yml
      loop_control:
         loop_var: aws_account
      loop: "{{aig_aws_accounts}}"


