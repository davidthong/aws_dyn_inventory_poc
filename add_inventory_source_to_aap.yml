---
- name: Build Patch Group Inventory
  hosts: localhost
  connection: local
  vars_files: aws_inventory_sources.yml

  tasks:

    - name: Create Inventory
      ansible.controller.inventory:
          name: "POC AWS"
          description: ""
          organization: "Default"
          state: present
     
    - name: Add AWS inventory source
      ansible.controller.inventory_source:
        name: "AWS EC2 - {{ aws_account }}"
        description: "POC"
        inventory: "POC AWS"
        overwrite: True
        update_on_launch: True
        overwrite_vars: True
        organization: Default
        source: "scm"
        source_project: "David POC"
        source_path: "inventory/aig_{{ aws_account }}.aws_ec2.yml"
        credential: "AWS"
      loop: "{{ aig_aws_accounts }}"
      loop_control:
         loop_var: aws_account
   


    # - name: Update AWS inventory sources
    #   ansible.controller.inventory_source_update:
    #     name: "AWS EC2 - {{survey_patch_group }}"
    #     inventory: "Patch Group - {{ survey_patch_group }}"
    #   when: survey_aws_vpc is defined
    
    
   